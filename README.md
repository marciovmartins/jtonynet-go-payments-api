<a id="header"></a>

<!-- 
    Logo image generated by Bing IA: https://www.bing.com/images/create/
    Prompt: gopher azul, simbolo da linguagem golang com um bone laranja, trabalhando como caixa de supermercado com algumas maquinhas de cartÃ£o de credito e cartÃµes em cima da mesa, estilo cartoon, historia em quadrinhos, fundo branco chapado para facilitar remoÃ§Ã£o
-->
[<img src="./docs/assets/images/layout/header.png" alt="gopher azul, simbolo da linguagem golang com um bone laranja, trabalhando como caixa de supermercado com algumas maquinhas de cartÃ£o de credito e cartÃµes em cima da mesa, estilo cartoon, historia em quadrinhos" />](#rgo-turn-based-challenge)

<!-- 
    icons by:
    https://devicon.dev/
    https://simpleicons.org/
-->
[<img src="./docs/assets/images/icons/go.svg" width="25px" height="25px" alt="Go Logo" title="Go">](https://go.dev/) [<img src="./docs/assets/images/icons/gin.svg" width="25px" height="25px" alt="Gin Logo" title="Gin">](https://gin-gonic.com/) [<img src="./docs/assets/images/icons/postgresql.svg" width="25px" height="25px" alt="PostgreSql Logo" title="PostgreSql">](https://www.postgresql.org/) [<img src="./docs/assets/images/icons/docker.svg" width="25px" height="25px" alt="Docker Logo" title="Docker">](https://www.docker.com/) [<img src="./docs/assets/images/icons/ubuntu.svg" width="25px" height="25px Logo" title="Ubuntu" alt="Ubuntu" />](https://ubuntu.com/) [<img src="./docs/assets/images/icons/dotenv.svg" width="25px" height="25px" alt="Viper DotEnv Logo" title="Viper DotEnv">](https://github.com/spf13/viper) [<img src="./docs/assets/images/icons/github.svg" width="25px" height="25px" alt="GitHub Logo" title="GitHub">](https://github.com/jtonynet)  [<img src="./docs/assets/images/icons/visualstudiocode.svg" width="25px" height="25px" alt="VsCode Logo" title="VsCode">](https://code.visualstudio.com/) [<img src="./docs/assets/images/icons/swagger.svg" width="25px" height="25px" alt="Swagger Logo" title="Swagger">](https://swagger.io/) [<img src="./docs/assets/images/icons/mermaidjs.svg" width="25px" height="25px" alt="MermaidJS Logo" title="MermaidJS">](https://mermaid.js.org/) [<img src="./docs/assets/images/icons/githubactions.svg" width="25px" height="25px" alt="GithubActions Logo" title="GithubActions">](https://docs.github.com/en/actions) <!-- [<img src="./docs/assets/images/icons/prometheus.svg" width="25px" height="25px" alt="Prometheus Logo" title="Prometheus">](https://prometheus.io/) [<img src="./docs/assets/images/icons/grafana.svg" width="25px" height="25px" alt="Grafana Logo" title="Grafana">](https://grafana.com/)  [<img src="./docs/assets/images/icons/gatling.svg" width="35px" height="35px" alt="Gatling Logo" title="Gatling">](https://gatling.com/) [<img src="./docs/assets/images/icons/redis.svg" width="25px" height="25px" alt="Redis Logo" title="Redis">](https://redis.com/) [<img src="./docs/assets/images/icons/rabbitmq.svg" width="25px" height="25px" alt="RabbitMQ Logo" title="RabbitMQ">](https://rabbitmq.com/) -->


![Badge Status](https://img.shields.io/badge/STATUS-EM_DESENVOLVIMENTO-green) [![Github Project](https://img.shields.io/badge/PROJECT%20VIEW%20KANBAN-GITHUB-green?logo=github&logoColor=white)](https://github.com/users/jtonynet/projects/7/views/1) <!-- ![Badge GitHubActions](https://github.com/jtonynet/go-payments-api/actions/workflows/main.yml/badge.svg?branch=main) -->

---

## ğŸ•¸ï¸ Redes

[![linkedin](https://img.shields.io/badge/Linkedin-0A66C2?style=for-the-badge&logo=linkedin&logoColor=white)](https://www.linkedin.com/in/jos%C3%A9-r-99896a39/) [![dev.to](https://img.shields.io/badge/dev.to-0A0A0A?style=for-the-badge&logo=devdotto&logoColor=white)](https://dev.to/learningenuity) [![gmail](https://img.shields.io/badge/Gmail-D14836?style=for-the-badge&logo=gmail&logoColor=white)](mailto:learningenuity@gmail.com)

---

## ğŸ“ O Projeto

<a id="index"></a>
### â¤´ï¸ Ãndice

__[Go Payments API](#header)__<br/>
  1.  â¤´ï¸ [Ãndice](#index)
  2.  ğŸ“– [Sobre](#about)
  3.  ğŸ’» [Rodando o Projeto](#run)
      - ğŸŒ [Ambiente](#environment)
      - ğŸ‹ [Conteinerizado](#run-containerized)
      - ğŸ  [Local](#run-locally)
  4.  ğŸ“° [DocumentaÃ§Ã£o da API](#apidocs)
  5.  ğŸ“Š [Diagramas](#diagrams)
      - ğŸ“ˆ [Fluxo](#diagrams-flowchart)
      - ğŸ“ˆ [ER](#diagrams-erchart)
  6.  âœ… [Testes](#tests)
  7.  ğŸª² [Debug](#debug)
  8.  ğŸ‘ [Boas PrÃ¡ticas](#best-practices)
  9.  ğŸ§  [ADR - Architecture Decision Records](#adr)
  10. ğŸ”¢ [VersÃµes](#versions)
  11. ğŸ§° [Ferramentas](#tools)
  12. ğŸ¤– [Uso de IA](#ia)
  13. ğŸ [ConclusÃ£o](#conclusion)

---

<a id="about"></a>
### ğŸ“– Sobre

Acompanhe as tarefas pelo __[Kanban](https://github.com/users/jtonynet/projects/7/views/1)__

Este repositÃ³rio foi criado com a intenÃ§Ã£o de propor uma possÃ­vel soluÃ§Ã£o para o seguinte desafio:

> <br/>
> 
> ğŸ‘¨â€ğŸ’» __Desafio TÃ©cnico:__
>
> AlÃ©m de avaliar a correÃ§Ã£o da sua soluÃ§Ã£o, temos interesse em ver como vocÃª modela o domÃ­nio, organiza seu cÃ³digo e implementa seus testes. 
>
>
> __Linguagem e bibliotecas:__
> 
> Na *********, usamos Scala e Kotlin no nosso dia a dia (e demonstrar experiÃªncia em alguma delas Ã© um grande diferencial). No entanto, vocÃª pode implementar sua soluÃ§Ã£o utilizando sua linguagem favorita, dando preferÃªncia ao paradigma de programaÃ§Ã£o funcional.
>
> __Como entregar a soluÃ§Ã£o?__
> 
> Entregue a sua soluÃ§Ã£o preferencialmente criando um repositÃ³rio git (Github, Gitlab, etc).
>
> Ã‰ muito importante escrever um arquivo README com as instruÃ§Ãµes para execuÃ§Ã£o do projeto.
> 
> Agora, vamos guiÃ¡-lo atravÃ©s de alguns conceitos bÃ¡sicos.
> 
> <br/>
> 
> ---
> 
> <br/>
> 
> __Transaction__
>
> Uma versÃ£o simplificada de um transaction payload de cartÃ£o de crÃ©dito Ã© o seguinte:
>
> ```json
> {
> 	"account": "123",
> 	"totalAmount": 100.00,
> 	"mcc": "5811",
> 	"merchant": "PADARIA DO ZE               SAO PAULO BR"
> }
> ```
>
>
> __Atributos__
>
> - **id** - Um identificador uÌnico para esta transacÌ§aÌƒo.
> - **accountId** - Um identificador para a conta.
> - **amount** - O valor a ser debitado de um saldo.
> - **merchant** - O nome do estabelecimento.
> - **mcc** - Um coÌdigo numeÌrico de 4 diÌgitos que classifica os estabelecimentos comerciais de acordo com o tipo de produto vendido ou servicÌ§o prestado.
>    
>    O `MCC` conteÌm a classificacÌ§aÌƒo do estabelecimento. Baseado no seu valor, deve-se decidir qual o saldo seraÌ utilizado (na totalidade do valor da transacÌ§aÌƒo). Por simplicidade, vamos usar a seguinte regra:
>    
>    - Se o `mcc` for `"5411"` ou `"5412"`, deve-se utilizar o saldo de `FOOD`.
>    - Se o `mcc` for `"5811"` ou `"5812"`, deve-se utilizar o saldo de `MEAL`.
>    - Para quaisquer outros valores do `mcc`, deve-se utilizar o saldo de `CASH`.
>
> <br/>
> 
> ---
>
> <br/>
> 
> __Desafios (o que vocÃª deve fazer)__
> 
> Cada um dos desafios a seguir sÃ£o etapas na criaÃ§Ã£o de um autorizador completo. Seu autorizador deve ser um servidor HTTP que processe a transaction payload JSON usando as regras a seguir.
>
> As possÃ­veis respostas sÃ£o:
> - `{ "code": "00" }` se a transaÃ§Ã£o Ã© **aprovada**
> - `{ "code": "51" }` se a transaÃ§Ã£o Ã© **rejeitada**, porque nÃ£o tem saldo suficiente
> - `{ "code": "07" }` se acontecer qualquer outro problema que impeÃ§a a transaÃ§Ã£o de ser processada
>
> __O HTTP Status Code Ã© sempre `200`__
> 
>
><br/>
>
> 1. __L1. Autorizador simples__
>     - O __autorizador simples__ deve funcionar da seguinte forma:
>       -  Recebe a transaÃ§Ã£o
>       -  Usa **apenas** a MCC para mapear a transaÃ§Ã£o para uma categoria de benefÃ­cios
>       -  Aprova ou rejeita a transaÃ§Ã£o
>       -  Caso a transaÃ§Ã£o seja aprovada, o saldo da categoria mapeada deverÃ¡ ser diminuÃ­do em __totalAmount__.
>
> 2. __L2. Autorizador com fallback__
>     - Para despesas nÃ£o relacionadas a benefÃ­cios, criamos outra categoria, chamada __CASH__. O autorizador com fallback deve funcionar como o autorizador simples, com a seguinte diferenÃ§a:
>       - Se a MCC nÃ£o puder ser mapeado para uma categoria de benefÃ­cios ou se o saldo da categoria fornecida nÃ£o for suficiente para pagar a transaÃ§Ã£o inteira, verifica o saldo de **CASH** e, se for suficiente, debita esse saldo.
>
> 3. __L3.Dependente do comerciante__
>     - As vezes, os MCCs estÃ£o incorretos e uma transaÃ§Ã£o deve ser processada levando em consideraÃ§Ã£o tambÃ©m os dados do comerciante. Crie um mecanismo para substituir MCCs com base no nome do comerciante. O nome do comerciante tem maior precedÃªncia sobre as MCCs.
>     - Exemplos:
>       - `UBER TRIP                   SAO PAULO BR`
>       - `UBER EATS                   SAO PAULO BR`
>       - `PAG*JoseDaSilva          RIO DE JANEI BR`
>       - `PICPAY*BILHETEUNICO           GOIANIA BR`
>   
> 4. __L4. QuestÃ£o aberta__
>     - A seguir estÃ¡ uma questÃ£o aberta sobre um recurso importante de um autorizador completo (que vocÃª nÃ£o precisa implementar, apenas discuta da maneira que achar adequada, como texto, diagramas, etc.).
>       - TransaÃ§Ãµes simultÃ¢neas: dado que o mesmo cartÃ£o de crÃ©dito pode ser utilizado em diferentes serviÃ§os online, existe uma pequena mas existente probabilidade de ocorrerem duas transaÃ§Ãµes ao mesmo tempo. O que vocÃª faria para garantir que apenas uma transaÃ§Ã£o por conta fosse processada em um determinado momento? Esteja ciente do fato de que todas as solicitaÃ§Ãµes de transaÃ§Ã£o sÃ£o sÃ­ncronas e devem ser processadas rapidamente (menos de 100 ms), ou a transaÃ§Ã£o atingirÃ¡ o timeout.
> 
> <br/>
> 
> ---
>
> <br/>
> 
> _Para este teste, tente ao mÃ¡ximo implementar um sistema de autorizaÃ§Ã£o de transaÃ§Ãµes considerando todos os desafios apresentados (L1 a L4) e conceitos bÃ¡sicos._
> 
> <br/>

<br/>

O desafio sugere `Scala`, `Kotlin` e o `paradigma de programaÃ§Ã£o funcional`, evidenciando preferÃªncias, mas aceitando subscriÃ§Ãµes com outras linguagens e paradigmas. Realizarei em `Golang`, com arquitetura `hexagonal`, por maior familiaridade e experiÃªncia.

Contudo, sou aberto a expandir minhas habilidades, e disposto a aprender e adotar novas tecnologias e paradigmas conforme necessÃ¡rio.

<br/>

[â¤´ï¸ de volta ao Ã­ndice](#index)

---

<a id="run"></a>
### ğŸ’» Rodando o Projeto

__TODO__

<a id="environment"></a>
#### ğŸŒ Ambiente
<br/>

<a id="run-containerized"></a>
#### ğŸ‹ Conteinerizado 
<br/>

<a id="run-locally"></a>
#### ğŸ  Local
<br/>

<br/>

[â¤´ï¸ de volta ao Ã­ndice](#index)

---

<a id="apidocs"></a>
### ğŸ“°  DocumentaÃ§Ã£o da API

__TODO__

<br/>

[â¤´ï¸ de volta ao Ã­ndice](#index)

---

<a id="diagrams"></a>
### ğŸ“Š Diagramas do Sistema
_*Diagramas embrionÃ¡rios_

_**Diagramas Mermaid podem apresentar problemas de visualizaÃ§Ã£o em aplicativos mobile_

<!-- 
    diagrams by:
    https://mermaid.js.org/
-->

<a id="diagrams-flowchart"></a>
#### ğŸ“ˆ Fluxo

```mermaid
flowchart TD
    A[Recebe TransaÃ§Ã£o JSON] --> B[Inicia TransaÃ§Ã£o no Banco]
    B --> C[Buscar Saldos da Conta - com bloqueio]
    C --> D{Saldo Ã© suficiente na Categoria?}
    
    D -- Sim --> E[Debita Saldo da Categoria]
    D -- NÃ£o --> F{Saldo suficiente em CASH?}
    
    F -- Sim --> G[Debita Saldo de CASH]
    F -- NÃ£o --> H[Rejeita TransaÃ§Ã£o com CÃ³digo 51]
    
    G --> I[Registrar TransaÃ§Ã£o Aprovada]
    E --> I[Registrar TransaÃ§Ã£o Aprovada]
    
    I --> J[Commit no Banco de Dados]
    J --> K[Retorna CÃ³digo 00 - Aprovada]
    
    H --> L[Retorna CÃ³digo 51 Rejeitada]
```

##### ğŸ“ DescriÃ§Ã£o

1. **Recebe TransaÃ§Ã£o JSON**: O sistema recebe o payload de transaÃ§Ã£o.

2. **Inicia TransaÃ§Ã£o no Banco**: Abre uma transaÃ§Ã£o no banco de dados para garantir atomicidade.

3. **Buscar Saldos da Conta**: A conta e os saldos (FOOD, MEAL, CASH) sÃ£o buscados no banco de dados com um bloqueio exclusivo para evitar concorrÃªncia.

4. **Saldo Ã© suficiente na Categoria?**: Verifica se o saldo disponÃ­vel na categoria mapeada (com base no MCC) Ã© suficiente.
    - Se sim, debita o saldo da categoria correspondente.
    - Se nÃ£o, verifica o saldo de CASH.

5. **Saldo suficiente em CASH?**: Se a categoria principal nÃ£o tiver saldo suficiente, o sistema verifica o saldo de CASH.
    - Se sim, debita o saldo de CASH.
    - Se nÃ£o, rejeita a transaÃ§Ã£o com o cÃ³digo "51" (fundos insuficientes).

6. **Registrar TransaÃ§Ã£o Aprovada**: A transaÃ§Ã£o aprovada Ã© registrada no banco de dados.

7. **Commit no Banco de Dados**: Confirma a transaÃ§Ã£o no banco, persistindo as mudanÃ§as.

8. **Retorna CÃ³digo "00"**: Se a transaÃ§Ã£o foi aprovada, retorna o cÃ³digo "00" (aprovada).

9. **Retorna CÃ³digo "51"**: Se a transaÃ§Ã£o foi rejeitada por falta de fundos, retorna o cÃ³digo "51".


<br/>

_*Esse fluxo representa o processo de aprovaÃ§Ã£o, fallback e rejeiÃ§Ã£o da transaÃ§Ã£o com base nos saldos e MCC, garantindo bloqueio exclusivo ao manipular os saldos._

---

<br/>

<a id="diagrams-erchart"></a>
#### ğŸ“ˆ Entidade Relacionamento

```mermaid
erDiagram
    accounts {
        int id PK
        UUID uuid
        datetime created_at
        datetime updated_at
    }

    balances {
        int id PK
        UUID uuid
        int account_id FK
        enum category
        int amount
        timestamp created_at
        timestamp updated_at
        timestamp deleted_at
    }

    transactions {
        int id
        UUID uuid
        int account_id FK
        string mcc
        string merchant
        int total_amount
        int approved_amount
        enum status
        timestamp created_at
        timestamp updated_at
    }
    
    mcc_merchant_map {
        int id PK
        UUID uuid
        string merchant_name
        string mcc
        string mapped_mcc
    }

    accounts ||--o{ balances : has
    accounts ||--o{ transactions : performs
    transactions ||--|| mcc_merchant_map : "maps to"
```

##### ğŸ“ DescriÃ§Ã£o

**Accounts** Ã© a tabela principal, conectada tanto a **Balances** quanto a **Transactions**, armazenando informaÃ§Ãµes sobre as contas.  
**Balances** armazena os saldos por categoria.  
**Transactions** registra o histÃ³rico de transaÃ§Ãµes realizadas, enquanto **MCC_Merchant_Map** ajusta MCCs incorretos de acordo com o nome do comerciante.

_*Esse diagrama oferece uma visÃ£o clara de como modelar as entidades principais e seus relacionamentos para atender aos requisitos do sistema de autorizaÃ§Ã£o de transaÃ§Ãµes._


<br/>

[â¤´ï¸ de volta ao Ã­ndice](#index)

---

<a id="tests"></a>
### âœ… Testes

__TODO__

<br/>

[â¤´ï¸ de volta ao Ã­ndice](#index)

---

<a id="debug"></a>
### ğŸª² Debug

__TODO__

<br/>

[â¤´ï¸ de volta ao Ã­ndice](#index)

---

<a id="best-practices"></a>
### ğŸ‘ Boas PrÃ¡ticas

- [Swagger](https://swagger.io/)
- [Github Project - Kanban](https://github.com/users/jtonynet/projects/7/views/1)
- [Semantic Versioning 2.0.0](https://semver.org/spec/v2.0.0.html)
- [Conventional Commits](https://www.conventionalcommits.org/en/v1.0.0/)
- [Keep a Changelog](https://keepachangelog.com/en/1.0.0/)
- [ADR - Architecture Decision Records](https://cognitect.com/blog/2011/11/15/documenting-architecture-decisions)
- [Mermaid Diagrams](https://mermaid.js.org)
<!--
- [Observabilidade](https://en.wikipedia.org/wiki/Observability_(software)) com:
  - [Prometheus](.)
  - [Grafana](https://grafana.com/)
-->

<br/>

[â¤´ï¸ de volta ao Ã­ndice](#index)

---

<a id="adr"></a> 
### ğŸ§  ADR - Architecture Decision Records

- [0001: Registro de DecisÃµes de Arquitetura (ADR)](./docs/architecture/decisions/0001-registro-de-decisoes-de-arquitetura.md)
- [0002: Go, Gin, Gorm e PostgreSQL com Arquitetura Hexagonal e TDD](./docs/architecture/decisions/0002-go-gin-gorm-e-postgres-com-arquitetura-hexagonal-tdd.md)



<br/>

[â¤´ï¸ de volta ao Ã­ndice](#index)

---

<a id="versions"></a>
### ğŸ”¢ VersÃµes

As tags de versÃµes estÃ£o sendo criadas manualmente a medida que o projeto avanÃ§a com melhorias notÃ¡veis. Cada funcionalidade Ã© desenvolvida em uma branch a parte (Branch Based, [feature branch](https://www.atlassian.com/git/tutorials/comparing-workflows/feature-branch-workflow)) quando finalizadas Ã© gerada tag e mergeadas em master.

Para obter mais informaÃ§Ãµes, consulte o [HistÃ³rico de VersÃµes](./CHANGELOG.md).

<br/>

[â¤´ï¸ de volta ao Ã­ndice](#index)

---

<a id="tools"></a>
### ğŸ§° Ferramentas


- Linguagem:
  - [Go](https://go.dev/)
  - [GVM v1.0.22](https://github.com/moovweb/gvm)

- Framework & Libs:
  - [Gin](https://gin-gonic.com/)
  - [GORM](https://gorm.io/index.html)
  - [Viper](https://github.com/spf13/viper)
  - [Gin-Swagger](https://github.com/swaggo/gin-swagger)
  - [gjson](https://github.com/tidwall/gjson)
  - [uuid](github.com/google/uuid)
<!-- 
  - [gin-contrib/pprof](https://github.com/gin-contrib/pprof)
  - [Exponential Backoff](https://github.com/cenkalti/backoff)
  - [go-redis](https://github.com/redis/go-redis)
  - [amqp091-go](https://github.com/rabbitmq/amqp091-go)
-->

- Infra & Tecnologias
  - [Docker v24.0.6](https://www.docker.com/)
  - [Docker compose v2.21.0](https://www.docker.com/)
  - [Postgres v16.0](https://www.postgresql.org/)
<!--
  - [Gatling v3.9.5](https://gatling.io/)
  - [Redis 6.2](https://redis.io/)
  - [RabbitMQ v3.12.6](https://www.rabbitmq.com/)
-->

- GUIs:
  - [VsCode](https://code.visualstudio.com/)
  - [DBeaver](https://dbeaver.io/)
<!--
  - [another-redis-desktop-manager](https://github.com/qishibo/AnotherRedisDesktopManager)
-->

<br/>

[â¤´ï¸ de volta ao Ã­ndice](#index)

---

<a id="ia"></a>
### ğŸ¤– Uso de IA

A figura do cabeÃ§alho nesta pÃ¡gina foi criada com a ajuda de inteligÃªncia artificial e um mÃ­nimo de retoques e construÃ§Ã£o no Gimp [<img src="./docs/assets/images/icons/gimp.svg" width="30" height="30 " title="Gimp" alt="Gimp Logo" />](https://www.gimp.org/)


__Os seguintes prompts foram usados para criaÃ§Ã£o no  [Bing IA:](https://www.bing.com/images/create/)__


<details>
  <summary><b>Gopher caixa de mercado</b></summary>
"gopher azul, simbolo da linguagem golang com um bone laranja, trabalhando como caixa de supermercado com algumas maquinhas de cartÃ£o de credito e cartÃµes em cima da mesa, estilo cartoon, historia em quadrinhos, fundo branco chapado para facilitar remoÃ§Ã£o"<b>(sic)</b>
</details>

<br/>

IA tambÃ©m Ã© utilizada em minhas pesquisas e estudos como ferramenta de apoio; no entanto,  __artes e desenvolvimento sÃ£o, acima de tudo, atividades criativas humanas. Valorize as pessoas!__

Contrate artistas para projetos comerciais ou mais elaborados e aprenda a ser engenhoso!

[â¤´ï¸ de volta ao Ã­ndice](#index)

<br/>

---

<a id="conclusion"></a>
### ğŸ ConclusÃ£o

__TODO__

ğŸ˜ŠğŸš€

<br/>

[â¤´ï¸ de volta ao Ã­ndice](#index)

---

<!-- 
// Removendo processos de uma porta. ex.: 3000
sudo kill -9 $(lsof -t -i:3000)

//LIMPANDO DOCKER
docker stop $(docker ps -aq)
docker rm $(docker ps -aq)

docker rmi $(docker images -q) --force

docker volume rm $(docker volume ls -q) --force

docker network prune -f

docker system prune -a --volumes

sudo systemctl restart docker
-->
